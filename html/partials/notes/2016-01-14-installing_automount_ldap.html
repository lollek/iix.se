<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Installing Automount on System (using LDAP)</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/bootstrap_custom.css">

  </head>
  <body>
    <nav class="navbar navbar-default navbar-inverse navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <a class="navbar-brand" href="/">iix-notes</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/notes.html">Notes</a></li>
        <li><a href="/beer.html">Beerlist</a></li>
        <li><a href="/wishlist.html">Wishlist</a></li>
        <li><a href="/moria">Moria</a></li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>


        <div class="container" role="main"><div class="panel panel-default">
  <div class="panel-heading">
    <h1 class="panel-title"> Installing Automount on System (using LDAP) </h1>
  </div>
  <div class="panel-body">



<h2 id="description">Description:</h2>
<p>Setup autofs on machines client-1 and client-2, which both uses ldap (how to install is described in a previous note)</p>

<h2 id="implementation">Implementation:</h2>
<ul>
  <li>Install package autofs5-ldap</li>
  <li>Create autofs.ldif with the following data:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>dn: cn=autofs,cn=schema,cn=config
objectClass: olcSchemaConfig
cn: autofs
olcAttributeTypes: {0}( 1.3.6.1.1.1.1.25 NAME 'automountInformation' DESC 'Inf
 ormation used by the autofs automounter' EQUALITY caseExactIA5Match SYNTAX 1.
 3.6.1.4.1.1466.115.121.1.26 SINGLE-VALUE )
olcObjectClasses: {0}( 1.3.6.1.1.1.1.13 NAME 'automount' DESC 'An entry in an 
 automounter map' SUP top STRUCTURAL MUST ( cn $ automountInformation $ object
 class ) MAY description )
olcObjectClasses: {1}( 1.3.6.1.4.1.2312.4.2.2 NAME 'automountMap' DESC 'An gro
 up of related automount objects' SUP top STRUCTURAL MUST ou )
</code></pre>
</div>

<ul>
  <li>Add the ldif to ldap:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>ldapadd -Y EXTERNAL -D cn=admin,(..) -W -f autofs.ldif
</code></pre>
</div>

<ul>
  <li>Create ldif with automount information and a test-user:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>dn: ou=auto.master,ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se
ou: auto.master
objectClass: top
objectClass: automountMap

dn: cn=/home,ou=auto.master,ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se
cn: /home
objectClass: top
objectClass: automount
automountInformation: ldap:ou=auto.home,ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se --timeout=60 --ghost

dn: ou=auto.home,ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se
ou: auto.home
objectClass: top
objectClass: automountMap

dn: cn=ollehome1,ou=auto.home,ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se
cn: ollehome1
objectClass: top
objectClass: automount
automountInformation: -fstype=nfs,nfsvers=3,rw,soft,intr,exec server.d4.sysinst.ida.liu.se:/export/home1/&amp;
</code></pre>
</div>

<ul>
  <li>Add ldif to ldap:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>ldapadd -D cn=admin,(..) -W -f autodata.ldif
</code></pre>
</div>

<ul>
  <li>Edit/enable the following lines in /etc/default/autofs:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>LOGGING="verbose"
LDAP_URI="ldap://server.d4.sysinst.ida.liu.se"
SEARCH_BASE="ou=automount,dc=d4,dc=sysinst,dc=ida,dc=liu,dc=se"
MAP_OBJECT_CLASS="automountMap"
ENTRY_OBJECT_CLASS="automount"
MAP_ATTRIBUTE="ou"
ENTRY_ATTRIBUTE="cn"
VALUE_ATTRIBUTE="automountInformation"
</code></pre>
</div>

<ul>
  <li>Add automount to /etc/nsswitch.conf:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>automount:      files ldap
</code></pre>
</div>

<ul>
  <li>Restart autofs:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>service autofs restart
</code></pre>
</div>

<h2 id="verification">Verification:</h2>
<p>Should be able to login on both hosts with ollehome1</p>


  </div>
</div>

</div>

    <!-- jQuery and Bootstrap -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
  </body>
</html>
